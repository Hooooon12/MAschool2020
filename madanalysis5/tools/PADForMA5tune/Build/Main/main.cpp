////////////////////////////////////////////////////////////////////////////////
//  
//  This file has been generated by MadAnalysis 5.
//  The MadAnalysis development team: <ma5team@iphc.cnrs.fr>
//                Eric Conte and Benjamin Fuks
//  Official website: <https://launchpad.net/madanalysis5>
//  
////////////////////////////////////////////////////////////////////////////////

// SampleHeader header
#include "SampleAnalyzer/Process/Core/SampleAnalyzer.h"
#include "SampleAnalyzer/User/Analyzer/analysisList.h"
using namespace MA5;

// -----------------------------------------------------------------------
// Info function
// -----------------------------------------------------------------------
int Info(SampleAnalyzer& manager)
{
  INFO << "BEGIN " << __FILE__ << endmsg;
  manager.AnalyzerList().Print();
  INFO << "END " << __FILE__ << endmsg;
  return 0;
}
// -----------------------------------------------------------------------
// main program
// -----------------------------------------------------------------------
int main(int argc, char *argv[])
{
  // Creating a manager
  SampleAnalyzer manager;
  BuildUserTable(manager.AnalyzerList());

  // Identifying --info argument
  if (argc==2)
  {
    std::string arg=argv[1];
    if (arg=="--info") return Info(manager);
  }

  // ---------------------------------------------------
  //                    INITIALIZATION
  // ---------------------------------------------------
  INFO << "    * Initializing all components" << endmsg;

  // Initializing the manager
  if (!manager.Initialize(argc,argv,"pdg.ma5")) return 1;

  // Creating data format for storing data
  EventFormat myEvent;
  std::vector<SampleFormat> mySamples;

  // Getting pointer to the analyzer
  std::map<std::string, std::string> prmcms_sus_14_001_toptag;
  AnalyzerBase* analyzer_cms_sus_14_001_toptag=
    manager.InitializeAnalyzer("cms_sus_14_001_toptag","cms_sus_14_001_toptag.saf",prmcms_sus_14_001_toptag);
  if (analyzer_cms_sus_14_001_toptag==0) return 1;

  std::map<std::string, std::string> prmcms_sus_14_001_monojet;
  AnalyzerBase* analyzer_cms_sus_14_001_monojet=
    manager.InitializeAnalyzer("cms_sus_14_001_monojet","cms_sus_14_001_monojet.saf",prmcms_sus_14_001_monojet);
  if (analyzer_cms_sus_14_001_monojet==0) return 1;

  std::map<std::string, std::string> prmcms_sus_13_016;
  AnalyzerBase* analyzer_cms_sus_13_016=
    manager.InitializeAnalyzer("cms_sus_13_016","cms_sus_13_016.saf",prmcms_sus_13_016);
  if (analyzer_cms_sus_13_016==0) return 1;

  std::map<std::string, std::string> prmcms_sus_13_012;
  AnalyzerBase* analyzer_cms_sus_13_012=
    manager.InitializeAnalyzer("cms_sus_13_012","cms_sus_13_012.saf",prmcms_sus_13_012);
  if (analyzer_cms_sus_13_012==0) return 1;

  std::map<std::string, std::string> prmatlas_susy_2013_05;
  AnalyzerBase* analyzer_atlas_susy_2013_05=
    manager.InitializeAnalyzer("atlas_susy_2013_05","atlas_susy_2013_05.saf",prmatlas_susy_2013_05);
  if (analyzer_atlas_susy_2013_05==0) return 1;

  std::map<std::string, std::string> prmatlas_susy_2014_10;
  AnalyzerBase* analyzer_atlas_susy_2014_10=
    manager.InitializeAnalyzer("atlas_susy_2014_10","atlas_susy_2014_10.saf",prmatlas_susy_2014_10);
  if (analyzer_atlas_susy_2014_10==0) return 1;

  std::map<std::string, std::string> prmatlas_susy_2013_21;
  AnalyzerBase* analyzer_atlas_susy_2013_21=
    manager.InitializeAnalyzer("atlas_susy_2013_21","atlas_susy_2013_21.saf",prmatlas_susy_2013_21);
  if (analyzer_atlas_susy_2013_21==0) return 1;

  std::map<std::string, std::string> prmatlas_susy_2013_11;
  AnalyzerBase* analyzer_atlas_susy_2013_11=
    manager.InitializeAnalyzer("atlas_susy_2013_11","atlas_susy_2013_11.saf",prmatlas_susy_2013_11);
  if (analyzer_atlas_susy_2013_11==0) return 1;

  std::map<std::string, std::string> prmatlas_susy_2013_04;
  AnalyzerBase* analyzer_atlas_susy_2013_04=
    manager.InitializeAnalyzer("atlas_susy_2013_04","atlas_susy_2013_04.saf",prmatlas_susy_2013_04);
  if (analyzer_atlas_susy_2013_04==0) return 1;

  std::map<std::string, std::string> prmatlas_higg_2013_03;
  AnalyzerBase* analyzer_atlas_higg_2013_03=
    manager.InitializeAnalyzer("atlas_higg_2013_03","atlas_higg_2013_03.saf",prmatlas_higg_2013_03);
  if (analyzer_atlas_higg_2013_03==0) return 1;

  std::map<std::string, std::string> prmatlas_susy_2013_02;
  AnalyzerBase* analyzer_atlas_susy_2013_02=
    manager.InitializeAnalyzer("atlas_susy_2013_02","atlas_susy_2013_02.saf",prmatlas_susy_2013_02);
  if (analyzer_atlas_susy_2013_02==0) return 1;

  std::map<std::string, std::string> parametersA1;
  AnalyzerBase* analyzer1 = 
      manager.InitializeAnalyzer("cms_sus_13_011","cms_sus_13_011.saf",parametersA1);
  if (analyzer1==0) return 1;

  // Post initialization (creates the new output directory structure)
  if(!manager.PostInitialize()) return 1;

  // ---------------------------------------------------
  //                      EXECUTION
  // ---------------------------------------------------
  INFO << "    * Running over files ..." << endmsg;

  // Loop over files
  while(1)
  {
    // Opening input file
    mySamples.push_back(SampleFormat());
    SampleFormat& mySample=mySamples.back();
    StatusCode::Type result1 = manager.NextFile(mySample);
    if (result1!=StatusCode::KEEP)
    {
      if (result1==StatusCode::SKIP) continue;
      else if (result1==StatusCode::FAILURE) {mySamples.pop_back(); break;}
    }
    
    // Loop over events
    while(1)
    {
      StatusCode::Type result2 = manager.NextEvent(mySample,myEvent);
      if (result2!=StatusCode::KEEP)
      {
        if (result2==StatusCode::SKIP) continue;
        else if (result2==StatusCode::FAILURE) break;
      }
          manager.UpdateProgressBar();
      if (!analyzer_cms_sus_14_001_toptag->Execute(mySample,myEvent)) continue;
      if (!analyzer_cms_sus_14_001_monojet->Execute(mySample,myEvent)) continue;
      if (!analyzer_cms_sus_13_016->Execute(mySample,myEvent)) continue;
      if (!analyzer_cms_sus_13_012->Execute(mySample,myEvent)) continue;
      if (!analyzer_atlas_susy_2013_05->Execute(mySample,myEvent)) continue;
      if (!analyzer_atlas_susy_2014_10->Execute(mySample,myEvent)) continue;
      if (!analyzer_atlas_susy_2013_21->Execute(mySample,myEvent)) continue;
      if (!analyzer_atlas_susy_2013_11->Execute(mySample,myEvent)) continue;
      if (!analyzer_atlas_susy_2013_04->Execute(mySample,myEvent)) continue;
      if (!analyzer_atlas_higg_2013_03->Execute(mySample,myEvent)) continue;
      if (!analyzer_atlas_susy_2013_02->Execute(mySample,myEvent)) continue;
      if (!analyzer1->Execute(mySample,myEvent)) continue;
    }
  }

  // ---------------------------------------------------
  //                     FINALIZATION
  // ---------------------------------------------------
  INFO << "    * Finalizing all components ..." << endmsg;

  // Finalizing all components
  manager.Finalize(mySamples,myEvent);
  return 0;
}
